function Chat(){var i={};return i.debug=!1,i.talk={},i.version="1.0.3",i.configuration={behaviour:{autoScroll:!0,autoDetectLanguage:!1,autoScrollAfterFirstAnswer:!0,autoResize:!0,defaultLang:"en",showTypingDots:!0,useEmoji:!0,useInputs:!0,useLanguages:!1},ids:{mainChat:"chat",answerPrefix:"answer-"},classes:{answer:"chat-answer",answerWrap:"chat-answer-select",bubbleWrap:"chat-bubble",bubble:"chat-bubble-msg",bubbleBot:"chat-bubble-msg-me",bubbleVisitor:"chat-bubble-msg-visitor",chatWrap:"chat-wrap",emojiPrefix:"em em-"},times:{delay:{overall:0,dots:700,botsTalk:1200,showAnswer:200},speed:{dotsFadeInOut:400,chatBlockFadeIn:400,scrollingSpeed:700}}},i.talkPosition="init",i.browserLanguage="",i.usedLang="",i.heightChat=0,i.heightAnswers=0,i.init=function(i){if("undefined"==typeof jQuery)throw"Error: jQuery is required but not loaded.";if(void 0===i)throw"Error: No configuration found. Either pass ajax parameter or whole settings";this.browserLanguage=navigator.language||navigator.userLanguage,void 0!==i.ajax?(this.chatLog("Fetching ajax settings..."),$.getJSON(i.ajax,function(i){this.parseSettings(i),this.generateHtml(),this.parseTalks(i),setTimeout(function(){this.botTalks()}.bind(this),this.configuration.times.delay.overall)}.bind(this))):(this.chatLog("Using settings passed by parameter..."),this.parseSettings(i),this.generateHtml(),this.parseTalks(i),setTimeout(function(){this.botTalks()}.bind(this),this.configuration.times.delay.overall))},i.parseSettings=function(i){if(void 0===i)throw"Error: JSON settings not found..";void 0!==i.config&&(void 0!==i.config.debug&&(this.debug=1==i.config.debug),void 0!==i.config.behaviour&&$.each(i.config.behaviour,function(i,t){void 0!==this.configuration.behaviour[i]&&(this.configuration.behaviour[i]=t)}.bind(this)),void 0!==i.config.classes&&$.each(i.config.classes,function(i,t){void 0!==this.configuration.classes[i]&&(this.configuration.classes[i]=t)}.bind(this)),void 0!==i.config.ids&&$.each(i.config.ids,function(i,t){void 0!==this.configuration.ids[i]&&(this.configuration.ids[i]=t)}.bind(this)),void 0!==i.config.times&&$.each(i.config.times,function(i,t){$.each(t,function(t,s){if(void 0!==this.configuration.times[i][t]){if(!(s>=0))throw"Error: A configuration value for times."+i+"."+t+" < 0 is not allowed";this.configuration.times[i][t]=s}}.bind(this))}.bind(this))),0==this.configuration.behaviour.showTypingDots&&(this.configuration.times.delay.dots=0),1==this.configuration.autoScrollAfterFirstAnswer&&(this.autoScroll=!0),0==this.autoScroll&&(this.configuration.speed.scrollingSpeed=0)},i.handleLanguage=function(){1==this.configuration.behaviour.useLanguages&&(this.chatLog("Language usage activated"),1==this.configuration.behaviour.autoDetectLanguage?this.usedLang=this.browserLanguage.split("-")[0]:this.usedLang=this.configuration.behaviour.defaultLang,this.chatLog("Switched to '"+this.usedLang+"' language"))},i.parseTalks=function(i){if(this.handleLanguage(),void 0===i.talk)throw"Error: There is no talk declaration in JSON file...";if(1==this.configuration.behaviour.useLanguages&&""!=this.usedLang){if(void 0===i.talk[this.usedLang])throw"Error: Language '"+this.usedLang+"' could not be found...";if(void 0===i.talk[this.usedLang].init)throw"Error: There is no init point for talk in language "+this.usedLang+"...";this.talk=i.talk[this.usedLang],this.chatLog("Language found")}else{if(void 0===i.talk.init)throw"Error: There is no init point for talk...";this.talk=i.talk}},i.generateHtml=function(){if($("#"+this.configuration.ids.mainChat),0)throw"Error: Container #"+this.configuration.ids.mainChat+" not found.";var i='<div class="'+this.configuration.classes.chatWrap+'"></div>',t='<div class="'+this.configuration.classes.answerWrap+'"></div>';$("#"+this.configuration.ids.mainChat).append(i,t),this.heightAnswers=$("."+this.configuration.classes.answerWrap).height(),this.heightChat=$("#"+this.configuration.ids.mainChat).height()},i.botTalks=function(){if(this.chatLog("- Bot starts talking on "+this.talkPosition+".."),void 0===this.talk[this.talkPosition])return this.chatLog(" - No more answers available"),!1;if(void 0===this.talk[this.talkPosition].talks)throw"Error: No bot talks found";this.talk[this.talkPosition].talks.forEach(function(i,t){var s=this.configuration.times.delay.dots+this.configuration.times.delay.botsTalk*(t+1);setTimeout(function(){this.newChatBubble("bot",i)}.bind(this),s)}.bind(this));var i=this.talk[this.talkPosition].talks.length*(this.configuration.times.delay.botsTalk+this.configuration.times.delay.dots)+this.configuration.times.delay.showAnswer;setTimeout(function(){if(this.showAnswers(),1==this.configuration.behaviour.autoScroll){if(1==this.configuration.behaviour.autoScrollAfterFirstAnswer&&"init"==this.talkPosition)return this.chatLog("Skip scrolling on first reply.."),!1;this.chatLog("Scrolling..."),$("body").animate({scrollTop:$("."+this.configuration.classes.bubble+":last-of-type").position().top},this.configuration.times.scrollingSpeed)}}.bind(this),i)},i.newChatBubble=function(i,t){this.chatLog("- -- * Add new Bubble for "+i+" with "+t);var s="bot"==i?this.configuration.classes.bubbleBot:this.configuration.classes.bubbleVisitor,a=this.configuration.behaviour.showTypingDots?"...":this.formatContent(t),o=$("<div class='"+this.configuration.classes.bubbleWrap+"'><div class='"+this.configuration.classes.bubble+" "+s+"'>"+a+"</div></div>");if(o.hide(),$("#"+this.configuration.ids.mainChat+" ."+this.configuration.classes.chatWrap).append(o),o.fadeIn(this.configuration.times.speed.chatBlockFadeIn),1==this.configuration.behaviour.autoResize){var n=o.height();this.expandChat(n)}this.configuration.behaviour.showTypingDots&&setTimeout(function(){var i=this;o.find("."+i.configuration.classes.bubble).fadeOut(i.configuration.times.speed.dotsFadeInOut,function(){$(this).html(i.formatContent(t)).fadeIn(i.configuration.times.speed.dotsFadeInOut)})}.bind(this),this.configuration.times.delay.dots)},i.showAnswers=function(){this.chatLog("- Show answers for "+this.talkPosition+"...");var i="";if(void 0!==this.talk[this.talkPosition]&&void 0!==this.talk[this.talkPosition].answers){$("."+this.configuration.classes.answerWrap).html(""),this.talk[this.talkPosition].answers.forEach(function(t,s){this.chatLog("- -- - "+t),i=i+"<a href='javascript:;' class='"+this.configuration.classes.answer+"' id='"+this.configuration.ids.answerPrefix+s+"'>"+this.formatContent(t)+"</a>"}.bind(this));var t=$("<div>"+i+"</div>").click(function(i){if(void 0!==$(i.target).context)var t=$(i.target).context;else{if(void 0===$(i.target))throw"Answer could not be found... Changing your jQuery Version could help...";var t=$(i.target)[0]}this.answer(t.id.substr(this.configuration.ids.answerPrefix.length),t.innerHTML)}.bind(this));$("."+this.configuration.classes.answerWrap).append(t),1==this.configuration.behaviour.autoResize&&(this.heightAnswers=t.height(),this.expandChat(this.heightAnswers))}else this.chatLog("<< No other answers available..")},i.answer=function(i,t){var s="";if(void 0===this.talk[this.talkPosition])return!1;if(void 0===this.talk[this.talkPosition].next[i])throw"Error: There is no answer for "+i+" in "+this.talkPosition;s=this.talk[this.talkPosition].next[i],this.chatLog(">> Answer "+i+" of Talk position "+this.talkPosition+" selected.. Next: '"+s+"'.");var a=$('<div class="'+this.configuration.classes.bubbleWrap+'"><div class="'+this.configuration.classes.bubble+" "+this.configuration.classes.bubbleVisitor+'">'+t+"</div></div>").hide();if($("#"+this.configuration.ids.mainChat+" ."+this.configuration.classes.chatWrap).append(a),a.fadeIn(),$("."+this.configuration.classes.answerWrap).fadeOut().html("").fadeIn(),1==this.configuration.behaviour.autoResize){var o=a.height();this.expandChat(o)}this.talkPosition=s,this.botTalks()},i.formatContent=function(i){for(var t=/:input:([A-z]+):/;null!==(inputFields=t.exec(i));)null!=inputFields&&(i=i.replace(inputFields[0],'<input type="text" name="'+inputFields[1]+'" placeholder="Start typing...">'));for(var s=/\[([\w\s\-\'\=\#\+]+)\]\(([\w\/\.\:\-\?\#\=\%]+) \"([\w\s\-\'\=\#\+]+)\"\)/;null!==(links=s.exec(i));)null!=links&&void 0!==links[1]&&void 0!==links[2]&&void 0!==links[3]&&(i=i.replace(links[0],'<a href="'+links[2]+'" title="'+links[3]+'" target="_blank">'+links[1]+"</a> "));for(var s=/\[([\w\s\-\'\=\#\+]+)\]\(([\w\/\.\:\-\?\#\=\%]+)\)/;null!==(links=s.exec(i));)null!=links&&void 0!==links[1]&&void 0!==links[2]&&(console.log(links),i=i.replace(links[0],'<a href="'+links[2]+'" target="_blank">'+links[1]+"</a> "));if(1==this.configuration.behaviour.useEmoji)for(var a=/:emoji:([A-z]+):/;emojiFields=null!==a.exec(i);)i=i.replace(emojiFields[0],'<i class="'+this.configuration.classes.emojiPrefix+"-"+emojiFields[1]+'"></i>');return i},i.expandChat=function(i){this.chatLog("++++++++ Resize chat by "+i+"px"),1==this.configuration.behaviour.autoResize&&(this.heightChat=this.heightChat+i,$("#"+this.configuration.ids.mainChat).css("height",this.heightChat+"px"))},i.chatLog=function(i){1==this.debug&&console.log(i)},i}